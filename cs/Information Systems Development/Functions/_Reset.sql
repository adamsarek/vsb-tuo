DROP TABLE Visit;
DROP TABLE Visitor;
DROP TABLE Prisoner;
DROP TABLE Employee;
DROP TABLE Cell;

-- Generated by Oracle SQL Developer Data Modeler 19.4.0.350.1424
--   at:        2020-04-03 22:00:00 CET
--   site:      Oracle Database 12c
--   type:      Oracle Database 12c



CREATE TABLE Cell (
    cell_id           INTEGER NOT NULL,
    occupied          INTEGER NOT NULL,
	capacity          INTEGER NOT NULL
);

ALTER TABLE Cell ADD CONSTRAINT Cell_PK PRIMARY KEY ( cell_id );

CREATE TABLE Employee (
    employee_id       INTEGER NOT NULL,
    firstName         VARCHAR(50) NOT NULL,
    lastName          VARCHAR(50) NOT NULL,
    gender            CHAR(1),
    birthDate         DATE NOT NULL,
    warden            CHAR(1) NOT NULL,
	fired             CHAR(1) NOT NULL
);

ALTER TABLE Employee ADD CONSTRAINT Employee_PK PRIMARY KEY ( employee_id );

CREATE TABLE Prisoner (
    prisoner_id          INTEGER NOT NULL,
    firstName            VARCHAR(50) NOT NULL,
    lastName             VARCHAR(50) NOT NULL,
    gender               CHAR(1),
    birthDate            DATE NOT NULL,
    punishmentStartDate  DATE NOT NULL,
    punishmentEndDate    DATE NOT NULL,
	released             CHAR(1) NOT NULL,
    cell_id              INTEGER NOT NULL
);

ALTER TABLE Prisoner ADD CONSTRAINT Prisoner_PK PRIMARY KEY ( prisoner_id );

CREATE TABLE Visit (
    visit_id              INTEGER NOT NULL,
    visitDate             DATE NOT NULL,
    allowed               CHAR(1) NOT NULL,
    prisoner_id           INTEGER NOT NULL,
    visitor_id            INTEGER NOT NULL
);

CREATE UNIQUE INDEX Visit__IDXv1 ON
    Visit (
        visitDate
    ASC,
        prisoner_id
    ASC,
        visitor_id
    ASC );

ALTER TABLE Visit ADD CONSTRAINT Visit_PK PRIMARY KEY ( visit_id );

CREATE TABLE Visitor (
    visitor_id  INTEGER NOT NULL,
    firstName   VARCHAR(50) NOT NULL,
    lastName    VARCHAR(50) NOT NULL,
    gender      CHAR(1),
    birthDate   DATE NOT NULL,
    forbidden   CHAR(1) NOT NULL
);

ALTER TABLE Visitor ADD CONSTRAINT Visitor_PK PRIMARY KEY ( visitor_id );

ALTER TABLE Prisoner
    ADD CONSTRAINT Prisoner_Cell_FK FOREIGN KEY ( cell_id )
        REFERENCES Cell ( cell_id );

ALTER TABLE Visit
    ADD CONSTRAINT Visit_Prisoner_FK FOREIGN KEY ( prisoner_id )
        REFERENCES Prisoner ( prisoner_id );

ALTER TABLE Visit
    ADD CONSTRAINT Visit_Visitor_FK FOREIGN KEY ( visitor_id )
        REFERENCES Visitor ( visitor_id );



--  Integritni omezeni
ALTER TABLE Cell ADD CHECK(occupied >= 0 AND occupied <= capacity);
ALTER TABLE Cell ADD CHECK(capacity >= 1);
ALTER TABLE Employee ADD CHECK(warden IN('0','1'));
ALTER TABLE Employee ADD CHECK(fired IN('0','1'));
ALTER TABLE Prisoner ADD CHECK(punishmentStartDate < punishmentEndDate);
ALTER TABLE Prisoner ADD CHECK(released IN('0','1'));
ALTER TABLE Visit ADD CHECK(allowed IN(NULL,'0','1','2'));
ALTER TABLE Visitor ADD CHECK(forbidden IN('0','1'));



-- Oracle SQL Developer Data Modeler Summary Report: 
-- 
-- CREATE TABLE                             8
-- CREATE INDEX                             1
-- ALTER TABLE                             16
-- CREATE VIEW                              0
-- ALTER VIEW                               0
-- CREATE PACKAGE                           0
-- CREATE PACKAGE BODY                      0
-- CREATE PROCEDURE                         0
-- CREATE FUNCTION                          0
-- CREATE TRIGGER                           0
-- ALTER TRIGGER                            0
-- CREATE COLLECTION TYPE                   0
-- CREATE STRUCTURED TYPE                   0
-- CREATE STRUCTURED TYPE BODY              0
-- CREATE CLUSTER                           0
-- CREATE CONTEXT                           0
-- CREATE DATABASE                          0
-- CREATE DIMENSION                         0
-- CREATE DIRECTORY                         0
-- CREATE DISK GROUP                        0
-- CREATE ROLE                              0
-- CREATE ROLLBACK SEGMENT                  0
-- CREATE SEQUENCE                          0
-- CREATE MATERIALIZED VIEW                 0
-- CREATE MATERIALIZED VIEW LOG             0
-- CREATE SYNONYM                           0
-- CREATE TABLESPACE                        0
-- CREATE USER                              0
-- 
-- DROP TABLESPACE                          0
-- DROP DATABASE                            0
-- 
-- REDACTION POLICY                         0
-- TSDP POLICY                              0
-- 
-- ORDS DROP SCHEMA                         0
-- ORDS ENABLE SCHEMA                       0
-- ORDS ENABLE OBJECT                       0
-- 
-- ERRORS                                   0
-- WARNINGS                                 0

INSERT INTO Employee VALUES(1, 'Alena', 'Velka', 'F', '1982-06-02', 1, 0);
INSERT INTO Employee VALUES(2, 'Lubos', 'Maly', 'M', '1985-09-12', 0, 0);
INSERT INTO Employee VALUES(3, 'Ludek', 'Svacina', 'M', '1992-02-18', 0, 0);
INSERT INTO Employee VALUES(4, 'Zuzana', 'Nejedla', 'F', '1991-01-24', 0, 0);
INSERT INTO Employee VALUES(5, 'Petr', 'Patek', 'M', '1976-06-19', 0, 0);
INSERT INTO Employee VALUES(6, 'Viktor', 'Sobota', 'M', '1990-12-01', 0, 0);
INSERT INTO Employee VALUES(7, 'Zdenek', 'Smutny', 'M', '1989-01-01', 0, 0);
INSERT INTO Employee VALUES(8, 'Pavla', 'Ptakova', 'F', '1972-11-11', 0, 0);
INSERT INTO Employee VALUES(9, 'Hynek', 'Sazava', 'M', '1963-05-15', 0, 0);

INSERT INTO Cell VALUES(1, 2, 2);
INSERT INTO Cell VALUES(2, 3, 4);
INSERT INTO Cell VALUES(3, 4, 4);
INSERT INTO Cell VALUES(4, 3, 4);
INSERT INTO Cell VALUES(5, 1, 3);

INSERT INTO Prisoner VALUES(1, 'Zdena', 'Mrackova', 'F', '1976-08-01', '2001-02-18', '2021-12-12', 0, 4);
INSERT INTO Prisoner VALUES(2, 'Jakub', 'Hanzelka', 'M', '1986-05-20', '2010-06-13', '2030-09-08', 0, 3);
INSERT INTO Prisoner VALUES(3, 'Petr', 'Macek', 'M', '1991-10-10', '2010-09-12', '2028-11-16', 0, 3);
INSERT INTO Prisoner VALUES(4, 'Jan', 'Bures', 'M', '1985-04-15', '2011-05-31', '2021-05-01', 0, 4);
INSERT INTO Prisoner VALUES(5, 'Pavel', 'Peterka', 'M', '1982-04-15', '2014-02-16', '2021-09-18', 0, 4);
INSERT INTO Prisoner VALUES(6, 'Jan', 'Ptak', 'M', '1956-03-02', '2015-01-01', '2020-03-08', 0, 3);
INSERT INTO Prisoner VALUES(7, 'Ludek', 'Onderka', 'M', '1950-12-11', '2015-08-12', '2029-03-18', 0, 3);
INSERT INTO Prisoner VALUES(8, 'Jakub', 'Patera', 'M', '1964-04-19', '2016-04-16', '2025-07-02', 0, 2);
INSERT INTO Prisoner VALUES(9, 'Dominik', 'Zboril', 'M', '1948-05-11', '2017-08-05', '2021-09-08', 0, 2);
INSERT INTO Prisoner VALUES(10, 'Milena', 'Kratka', 'F', '1991-08-04', '2018-04-30', '2019-12-30', 0, 5);
INSERT INTO Prisoner VALUES(11, 'Vaclav', 'Park', 'M', '1941-06-19', '2019-03-21', '2027-12-06', 0, 2);
INSERT INTO Prisoner VALUES(12, 'Milos', 'Jiricka', 'M', '1944-09-28', '2019-10-28', '2025-05-01', 0, 1);
INSERT INTO Prisoner VALUES(13, 'Andrej', 'Svatek', 'M', '1954-09-02', '2019-11-17', '2039-11-17', 0, 1);

INSERT INTO Visitor VALUES(1, 'Mirek', 'Pan', 'M', '1975-08-30', 0);
INSERT INTO Visitor VALUES(2, 'Miroslav', 'Plachy', 'M', '1974-06-18', 0);
INSERT INTO Visitor VALUES(3, 'Jarmila', 'Solcova', 'F', '1990-02-15', 0);
INSERT INTO Visitor VALUES(4, 'Zdena', 'Novakova', 'F', '1966-01-29', 0);
INSERT INTO Visitor VALUES(5, 'Vaclav', 'Pesek', 'M', '1981-12-19', 1);
INSERT INTO Visitor VALUES(6, 'Bohdana', 'Cechova', 'F', '1989-03-30', 0);
INSERT INTO Visitor VALUES(7, 'Vratislav', 'Minar', 'M', '1974-11-20', 0);
INSERT INTO Visitor VALUES(8, 'Ivo', 'Krasny', 'M', '1980-10-10', 0);
INSERT INTO Visitor VALUES(9, 'Leos', 'Jaro', 'M', '1988-05-24', 0);
INSERT INTO Visitor VALUES(10, 'Marek', 'LÃ©to', 'M', '1986-01-29', 0);

INSERT INTO Visit VALUES(1, '2012-03-16', 0, 4, 5);
INSERT INTO Visit VALUES(2, '2013-05-24', 1, 4, 8);